define(["require","exports","chip8/core"],function(n,t,i){function r(n,t){return{opcode:n<<8|t,nibbles:[n>>4,n&15,t>>4,t&15],bytes:[n,t],NN:t,NNN:(n<<8|t)&4095}}function o(){var n=jasmine.createSpyObj("stack",["push","pop","getSP"]);return Object.defineProperty(n,"SP",{get:function(){return this.getSP()}}),n}function s(){var n=jasmine.createSpyObj("registers",["read","write"]),t;for(Object.defineProperty(n,"PC",{set:function(n){this.write("PC",n)},get:function(){return this.read("PC")}}),Object.defineProperty(n,"I",{set:function(n){this.write("PC",n)},get:function(){return this.read("PC")}}),t=0;t<=15;t++)(function(t){Object.defineProperty(n,"v"+t.toString(16).toUpperCase(),{set:function(n){this.write(t,n)},get:function(){return this.read(t)}})})(t);return n.fakeValues=function(t){n.read.andCallFake(function(n){return t[n]})},n}var u=i,f=u.chip8,e;(function(n){(function(){describe("A chip-8 core",function(){var t,n,i;beforeEach(function(){n=s(),i=o(),t=new f.Core(n,i)}),it("should execute the 00E0 - return instruction",function(){var u=r(0,224);i.pop.andReturn(1536),t.execute(u),expect(i.pop).toHaveBeenCalled(),expect(n.write).toHaveBeenCalledWith("PC",1536)}),it("should execute the 1NNN - jmp instruction",function(){var i=r(31,99);t.execute(i),expect(n.write).toHaveBeenCalledWith("PC",3939)}),it("should execute the 2NNN - call instruction",function(){var u=r(35,47);n.fakeValues({PC:528}),t.execute(u),expect(n.write).toHaveBeenCalledWith("PC",815),expect(i.push).toHaveBeenCalledWith(528)}),it("should execute the 3XNN - skip if equal instruction",function(){n.fakeValues({1:47,PC:512}),t.execute(r(49,47)),expect(n.write).toHaveBeenCalledWith("PC",514),n.write.reset(),t.execute(r(49,17)),expect(n.write).not.toHaveBeenCalledWith("PC",514)}),it("should execute the 4XNN - skip if not equal instruction",function(){n.fakeValues({1:47,PC:512}),t.execute(r(65,47)),expect(n.write).not.toHaveBeenCalledWith("PC",514),n.write.reset(),t.execute(r(65,17)),expect(n.write).toHaveBeenCalledWith("PC",514)}),it("should execute the 5XY0 - skip if X equal Y instruction",function(){n.fakeValues({1:47,2:47,3:17,PC:512}),t.execute(r(81,32)),expect(n.write).toHaveBeenCalledWith("PC",514),n.write.reset(),t.execute(r(81,48)),expect(n.write).not.toHaveBeenCalledWith("PC",514)}),it("should execute the 6XNN - set X to NN instruction",function(){t.execute(r(97,240)),expect(n.write).toHaveBeenCalledWith(1,240)}),it("should execute the 7XNN - add NN to X instruction",function(){n.fakeValues({1:32}),t.execute(r(113,37)),expect(n.write).toHaveBeenCalledWith(1,69),n.write.reset(),t.execute(r(113,255)),expect(n.write).toHaveBeenCalledWith(1,31)}),it("should execute the 8XY0 - set X to Y instruction",function(){n.fakeValues({5:106}),t.execute(r(129,80)),expect(n.write).toHaveBeenCalledWith(1,106)}),it("should execute the 8XY1 - set X to Z or Y instruction",function(){n.fakeValues({1:15,3:112}),t.execute(r(129,49)),expect(n.write).toHaveBeenCalledWith(1,127)}),it("should execute the 8XY2 - set X to Z and Y instruction",function(){n.fakeValues({1:195,2:15}),t.execute(r(129,34)),expect(n.write).toHaveBeenCalledWith(1,3)}),it("should execute the 8XY3 - set X to Z xor Y instruction",function(){n.fakeValues({1:108,2:85}),t.execute(r(129,35)),expect(n.write).toHaveBeenCalledWith(1,57)}),it("should execute the 8XY4 - add Y to X with carry instruction",function(){n.fakeValues({1:1,2:85,3:255}),t.execute(r(129,36)),expect(n.write).toHaveBeenCalledWith(15,0),expect(n.write).toHaveBeenCalledWith(1,86),n.write.reset(),t.execute(r(129,52)),expect(n.write).toHaveBeenCalledWith(15,1),expect(n.write).toHaveBeenCalledWith(1,0)}),it("should execute the 8XY5 - sub Y from X with borrow instruction",function(){n.fakeValues({1:16,2:5,3:32}),t.execute(r(129,37)),expect(n.write).toHaveBeenCalledWith(15,1),expect(n.write).toHaveBeenCalledWith(1,11),n.write.reset(),t.execute(r(129,53)),expect(n.write).toHaveBeenCalledWith(15,0),expect(n.write).toHaveBeenCalledWith(1,240)})})})(n.spec||(n.spec={}));var t=n.spec})(t.chip8||(t.chip8={})),e=t.chip8})