define(["require","exports"],function(n,t){(function(n){var t=function(){function n(n,t,i,r,u,f){this.registers=n,this.stack=t,this.memory=i,this.timers=r,this.screen=u,this.keypad=f,this.instructions=[],this.instructions8=[],this.instructionsF=[],this.halted=!1,this.mapInstructions(),this.keypad.onKeyDown.subscribe(this.keyDown.bind(this))}return n.prototype.keyDown=function(n){this.halted&&(this.registers.write(this.keypressTarget,n),this.halted=!1)},n.prototype.execute=function(n){this.instructions[n.nibbles[0]].call(this,n)},n.prototype.iClearScreen=function(){this.screen.clear()},n.prototype.iRet=function(){this.registers.PC=this.stack.pop()},n.prototype.iJmp=function(n){this.registers.PC=n.NNN},n.prototype.iJmpWithAdd=function(n){this.registers.PC=n.NNN+this.registers.v0},n.prototype.iCall=function(n){this.stack.push(this.registers.PC),this.registers.PC=n.NNN},n.prototype.iSkipEqual=function(n){this.registers.read(n.nibbles[1])===n.NN&&(this.registers.PC+=2)},n.prototype.iSkipXYNotEqual=function(n){this.registers.read(n.nibbles[1])!==this.registers.read(n.nibbles[2])&&(this.registers.PC+=2)},n.prototype.iSkipNotEqual=function(n){this.registers.read(n.nibbles[1])!==n.NN&&(this.registers.PC+=2)},n.prototype.iSkipXequalY=function(n){this.registers.read(n.nibbles[1])===this.registers.read(n.nibbles[2])&&(this.registers.PC+=2)},n.prototype.iSetX=function(n){this.registers.write(n.nibbles[1],n.NN)},n.prototype.iAddNtoX=function(n){var t=this.registers.read(n.nibbles[1]);this.registers.write(n.nibbles[1],t+n.NN&255)},n.prototype.branch8=function(n){this.instructions8[n.nibbles[3]].call(this,n)},n.prototype.iSetXtoY=function(n){this.registers.write(n.nibbles[1],this.registers.read(n.nibbles[2]))},n.prototype.iOrXwithY=function(n){var t=this.registers.read(n.nibbles[1])|this.registers.read(n.nibbles[2]);this.registers.write(n.nibbles[1],t)},n.prototype.iAndXwithY=function(n){var t=this.registers.read(n.nibbles[1])&this.registers.read(n.nibbles[2]);this.registers.write(n.nibbles[1],t)},n.prototype.iXorXwithY=function(n){var t=this.registers.read(n.nibbles[1])^this.registers.read(n.nibbles[2]);this.registers.write(n.nibbles[1],t)},n.prototype.iAddYtoXWithCarry=function(n){var t=this.registers.read(n.nibbles[1])+this.registers.read(n.nibbles[2]);this.registers.vF=t>>8>0?1:0,this.registers.write(n.nibbles[1],t&255)},n.prototype.iSubYfromXWithBorrow=function(n){var t=this.registers.read(n.nibbles[1])-this.registers.read(n.nibbles[2]);this.registers.vF=t<0?0:1,this.registers.write(n.nibbles[1],t&255)},n.prototype.iSubXfromYWithBorrow=function(n){var t=this.registers.read(n.nibbles[2])-this.registers.read(n.nibbles[1]);this.registers.vF=t<0?0:1,this.registers.write(n.nibbles[1],t&255)},n.prototype.iShiftXRightWithCarry=function(n){var t=this.registers.read(n.nibbles[1]);this.registers.vF=t&1,this.registers.write(n.nibbles[1],t>>1)},n.prototype.iShiftXLeftWithCarry=function(n){var t=this.registers.read(n.nibbles[1]);this.registers.vF=t>>7&1,this.registers.write(n.nibbles[1],t<<1&255)},n.prototype.iSetI=function(n){this.registers.I=n.NNN},n.prototype.iRandInX=function(n){this.registers.write(n.nibbles[1],Math.random()*255&n.NN)},n.prototype.branchF=function(n){this.instructionsF[n.NN].call(this,n)},n.prototype.iBCD=function(n){var t=this.registers.I,i=("000"+this.registers.read(n.nibbles[1]).toString(10)).substr(-3).split("");this.memory.write(t,parseInt(i[0])),this.memory.write(t+1,parseInt(i[1])),this.memory.write(t+2,parseInt(i[2]))},n.prototype.iAddXtoI=function(n){var t=this.registers.I+this.registers.read(n.nibbles[1]);this.registers.vF=t>4095?1:0,this.registers.I=t&4095},n.prototype.iSaveRegisters=function(n){for(var t=this.registers.I,r=t+n.nibbles[1],i=0;t<=r;i++,t++)this.memory.write(t,this.registers.read(i));this.registers.I=t},n.prototype.iLoadRegisters=function(n){for(var t=this.registers.I,r=t+n.nibbles[1],i=0;t<=r;i++,t++)this.registers.write(i,this.memory.read(t));this.registers.I=t},n.prototype.iLoadFontAddress=function(n){this.registers.I=this.registers.read(n.nibbles[1])*5},n.prototype.iSetXToDelay=function(n){this.registers.write(n.nibbles[1],this.timers.delay)},n.prototype.iSetDelayToX=function(n){this.timers.delay=this.registers.read(n.nibbles[1])},n.prototype.iSetSoundToX=function(n){this.timers.sound=this.registers.read(n.nibbles[1])},n.prototype.branch0=function(n){switch(n.NN){case 224:this.iClearScreen(n);break;case 238:this.iRet(n);break;default:console.log("Error")}},n.prototype.iDrawSprite=function(n){for(var i=[],u=this.registers.I,r,t=0;t<n.nibbles[3];t++)i.push(this.memory.read(u+t));r=this.screen.draw(this.registers.read(n.nibbles[1]),this.registers.read(n.nibbles[2]),i),this.registers.vF=r},n.prototype.iSkipOnKeyState=function(n){var t=this.keypad.read(this.registers.read(n.X));!!t!=(n.NN==161)&&(this.registers.PC+=2)},n.prototype.iAwaitKey=function(n){this.halted=!0,this.keypressTarget=n.X},n.prototype.mapInstructions=function(){this.instructions[0]=this.branch0,this.instructions[1]=this.iJmp,this.instructions[2]=this.iCall,this.instructions[3]=this.iSkipEqual,this.instructions[4]=this.iSkipNotEqual,this.instructions[5]=this.iSkipXequalY,this.instructions[6]=this.iSetX,this.instructions[7]=this.iAddNtoX,this.instructions[8]=this.branch8,this.instructions8[0]=this.iSetXtoY,this.instructions8[1]=this.iOrXwithY,this.instructions8[2]=this.iAndXwithY,this.instructions8[3]=this.iXorXwithY,this.instructions8[4]=this.iAddYtoXWithCarry,this.instructions8[5]=this.iSubYfromXWithBorrow,this.instructions8[6]=this.iShiftXRightWithCarry,this.instructions8[7]=this.iSubXfromYWithBorrow,this.instructions8[14]=this.iShiftXLeftWithCarry,this.instructions[9]=this.iSkipXYNotEqual,this.instructions[10]=this.iSetI,this.instructions[11]=this.iJmpWithAdd,this.instructions[12]=this.iRandInX,this.instructions[13]=this.iDrawSprite,this.instructions[14]=this.iSkipOnKeyState,this.instructions[15]=this.branchF,this.instructionsF[7]=this.iSetXToDelay,this.instructionsF[10]=this.iAwaitKey,this.instructionsF[21]=this.iSetDelayToX,this.instructionsF[24]=this.iSetSoundToX,this.instructionsF[30]=this.iAddXtoI,this.instructionsF[41]=this.iLoadFontAddress,this.instructionsF[51]=this.iBCD,this.instructionsF[85]=this.iSaveRegisters,this.instructionsF[101]=this.iLoadRegisters},n.prototype.loadFont=function(){this.memory.load(0,[240,144,144,144,240,32,96,32,32,112,240,16,240,128,240,240,16,240,16,240,144,144,240,16,16,240,128,240,16,240,240,128,240,144,240,240,16,32,64,64,240,144,240,144,240,240,144,240,16,240,240,144,240,144,144,224,144,224,144,224,240,128,128,128,240,224,144,144,144,224,240,128,240,128,240,240,128,240,128,128],-1)},n}();n.Core=t})(t.chip8||(t.chip8={}));var i=t.chip8})